<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Dark Idle</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body {
      background: #0e0e11;
      color: #ffffff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      margin: 0;
      padding-bottom: 70px;
    }

    h1 { font-size: 28px; margin-bottom: 10px; }
    h2 { margin-top: 0; }

    p { font-size: 18px; }

    button {
      background: #6f42c1;
      border: none;
      padding: 16px;
      color: white;
      font-size: 16px;
      border-radius: 14px;
      cursor: pointer;
      width: 100%;
      max-width: 320px;
      margin: 8px auto;
      display: block;
    }

    #tabs {
    <div id="tabbar">

  <div class="tab active" onclick="showTab('game', this)">
    <div class="icon">‚óâ</div>
    <div class="label">VOID</div>
  </div>

  <div class="tab" onclick="showTab('rating', this)">
    <div class="icon">‚üÅ</div>
    <div class="label">–†–∞–Ω–≥</div>
  </div>

</div>

    }

    #tabs button {
      flex: 1;
      margin: 0;
      border-radius: 0;
      background: transparent;
      color: #aaa;
    }

    #tabs button.active {
      color: #fff;
      background: #1f1f2a;
    }

    #leaderboard div {
      padding: 8px;
      border-bottom: 1px solid #2a2a33;
    }

    .void-card {
  background: radial-gradient(circle at top, #1a1a25, #0b0b0f);
  border-radius: 24px;
  padding: 30px 20px;
  box-shadow:
    0 0 40px rgba(111, 66, 193, 0.25),
    inset 0 0 30px rgba(0,0,0,0.8);
  margin-top: 20px;
}

.void-orb {
  width: 140px;
  height: 140px;
  margin: 0 auto 20px;
  border-radius: 50%;
  background: radial-gradient(circle, #7b4dff, #2a124f, #000);
  box-shadow:
    0 0 30px rgba(123,77,255,0.8),
    0 0 80px rgba(123,77,255,0.4);
  animation: pulse 3s infinite ease-in-out;
}

@keyframes pulse {
  0% { transform: scale(1); opacity: 0.85; }
  50% { transform: scale(1.08); opacity: 1; }
  100% { transform: scale(1); opacity: 0.85; }
}

.void-amount {
  font-size: 32px;
  font-weight: bold;
  margin-bottom: 6px;
}

.void-sub {
  font-size: 14px;
  opacity: 0.7;
  margin-bottom: 20px;
}

.void-btn {
  background: linear-gradient(135deg, #6f42c1, #8a63ff);
  box-shadow: 0 0 20px rgba(138,99,255,0.6);
  font-weight: bold;
}

.void-info {
  margin-top: 15px;
  font-size: 15px;
  opacity: 0.85;
}

      #tabbar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 64px;
  background: linear-gradient(180deg, #0e0e14, #09090d);
  border-top: 1px solid #1f1f2a;
  display: flex;
  z-index: 10;
}

.tab {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #777;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.25s ease;
}

.tab .icon {
  font-size: 20px;
  margin-bottom: 4px;
}

.tab.active {
  color: #c9b8ff;
}

.tab.active .icon {
  text-shadow:
    0 0 8px rgba(138,99,255,0.8),
    0 0 16px rgba(138,99,255,0.5);
}

  </style>
</head>

<body>

<h1>Dark Idle</h1>

<!-- GAME -->
<div id="game">

  <div class="void-card">
    <div class="void-orb"></div>

    <div class="void-amount" id="counter">0 VOID</div>
    <div class="void-sub">–¢—ë–º–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –∫–æ–Ω–¥–µ–Ω—Å–∏—Ä—É–µ—Ç—Å—è</div>

    <button class="void-btn" onclick="collect()">
      –ò–∑–≤–ª–µ—á—å VOID
    </button>

    <div class="void-info" id="info"></div>
  </div>

</div>


<!-- RATING -->
<div id="rating" style="display:none">
  <h2>üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h2>
  <div id="leaderboard"></div>
</div>

<!-- TABS -->
<div id="tabs">
  <button id="tab-game" class="active" onclick="showTab('game')">üéÆ –ò–≥—Ä–∞</button>
  <button id="tab-rating" onclick="showTab('rating')">üèÜ –†–µ–π—Ç–∏–Ω–≥</button>
</div>

<!-- SUPABASE INIT -->
<script>
  const SUPABASE_URL = "https://edosyzmykmoajecmaamu.supabase.co";
  const SUPABASE_KEY = "sb_publishable_bHorYMm55LbnpSXg96WwVw_C4weLD_O";

  const supabase = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_KEY
  );
</script>

<!-- GAME LOGIC -->
<script>
  const tg = Telegram.WebApp;
  const user = tg.initDataUnsafe?.user;

  if (!user) {
    alert("–û—Ç–∫—Ä–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram");
  }

  tg.ready();

  let data = {
    voids: 0,
    rate: 1,
    is_vip: false,
    lastTime: Date.now()
  };

  function updateIdle() {
    const now = Date.now();
    const seconds = Math.floor((now - data.lastTime) / 1000);
    if (seconds > 0) {
      const vipMultiplier = data.is_vip ? 2 : 1;
      data.voids += seconds * data.rate * vipMultiplier;
      data.lastTime = now;
    }
  }

  function render() {
    document.getElementById("counter").innerText =
      `VOID: ${Math.floor(data.voids)}`;
    document.getElementById("info").innerText =
      `–°–∫–æ—Ä–æ—Å—Ç—å: ${data.rate} VOID/—Å–µ–∫ ${data.is_vip ? "üëë VIP" : ""}`;
  }

  function collect() {
   if (navigator.vibrate) {
  navigator.vibrate(20);
}

Telegram.WebApp.HapticFeedback.impactOccurred("light");

    updateIdle();
    render();
    savePlayerToServer();
  }

  function upgrade() {
    if (data.voids >= 10) {
      data.voids -= 10;
      data.rate++;
      render();
      savePlayerToServer();
    } else {
      alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ VOID");
    }
  }

  async function loadPlayerFromServer() {
    const telegramId = user.id;

    let { data: player } = await supabase
      .from("players")
      .select("*")
      .eq("telegram_id", telegramId)
      .single();

    if (!player) {
      await supabase.from("players").insert({
        telegram_id: telegramId,
        voids: 0,
        rate: 1,
        is_vip: false
      });

      return { voids: 0, rate: 1, is_vip: false };
    }

    return player;
  }

  async function savePlayerToServer() {
    await supabase
      .from("players")
      .update({
        voids: Math.floor(data.voids),
        rate: data.rate,
        is_vip: data.is_vip,
        updated_at: new Date()
      })
      .eq("telegram_id", user.id);
  }

  async function loadLeaderboard() {
    const { data: list } = await supabase
      .from("players")
      .select("telegram_id, voids, is_vip")
      .order("voids", { ascending: false })
      .limit(100);

    const board = document.getElementById("leaderboard");
    board.innerHTML = "";

    list.forEach((p, i) => {
      const row = document.createElement("div");
      const isMe = p.telegram_id === user.id;

      row.innerText =
        `${i + 1}. ${isMe ? "üî• –¢—ã" : "–ò–≥—Ä–æ–∫"} ${p.is_vip ? "üëë" : ""} ‚Äî ${p.voids} VOID`;

      row.style.color = isMe ? "#ffd700" : "#fff";
      row.style.fontWeight = isMe ? "bold" : "normal";

      board.appendChild(row);
    });
  }

  function showTab(tab, el) {
  document.getElementById("game").style.display =
    tab === "game" ? "block" : "none";

  document.getElementById("rating").style.display =
    tab === "rating" ? "block" : "none";

  document.querySelectorAll(".tab").forEach(t =>
    t.classList.remove("active")
  );

  el.classList.add("active");

  if (tab === "rating") {
    loadLeaderboard();
  }
}

  (async () => {
    const serverData = await loadPlayerFromServer();

    data.voids = serverData.voids;
    data.rate = serverData.rate;
    data.is_vip = serverData.is_vip;
    data.lastTime = Date.now();

    render();
    loadLeaderboard();

    setInterval(savePlayerToServer, 15000);
    setInterval(loadLeaderboard, 20000);
  })();
</script>

</body>
</html>
