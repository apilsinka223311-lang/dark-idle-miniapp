<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Dark Idle</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  background: #0e0e11;
  color: #ffffff;
  font-family: Arial, sans-serif;
  text-align: center;
  padding: 20px;
  margin: 0;
  padding-bottom: 100px;
}

h1 {
  font-size: 26px;
  margin-bottom: 16px;
}

/* ===== VOID CARD ===== */
.void-card {
  background: radial-gradient(circle at top, #1a1a25, #0b0b0f);
  border-radius: 24px;
  padding: 30px 20px;
  box-shadow:
    0 0 40px rgba(111, 66, 193, 0.25),
    inset 0 0 30px rgba(0,0,0,0.8);
  margin-top: 20px;
}

/* ===== VOID ART + CANVAS ===== */
.void-orb {
  position: relative;
  width: 260px;
  height: 260px;
  margin: 0 auto 20px;
  border-radius: 50%;
  overflow: hidden;
}

#voidImage {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  filter:
    drop-shadow(0 0 60px rgba(160,130,255,0.75))
    brightness(1.15)
    contrast(1.1);
  animation: voidRotate 60s linear infinite;
}

@keyframes voidRotate {
  from { transform: rotate(0deg) scale(1.05); }
  to   { transform: rotate(360deg) scale(1.05); }
}

#voidCanvas {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

/* ===== TEXT ===== */
.void-amount {
  font-size: 32px;
  font-weight: bold;
  margin-bottom: 6px;
}

.void-sub {
  font-size: 14px;
  opacity: 0.7;
  margin-bottom: 20px;
}

.void-btn {
  background: linear-gradient(135deg, #6f42c1, #8a63ff);
  box-shadow: 0 0 20px rgba(138,99,255,0.6);
  border: none;
  padding: 16px;
  color: white;
  font-size: 16px;
  border-radius: 14px;
  cursor: pointer;
  width: 100%;
  max-width: 320px;
  margin: 10px auto;
}

.void-info {
  margin-top: 15px;
  font-size: 15px;
  opacity: 0.85;
}

/* ===== TABBAR ===== */
#tabbar {
  position: fixed;
  bottom: 12px;
  left: 12px;
  right: 12px;
  height: 64px;
  background: rgba(20,20,30,0.6);
  backdrop-filter: blur(14px);
  border-radius: 20px;
  display: flex;
  justify-content: space-around;
  align-items: center;
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 10px 30px rgba(0,0,0,0.6);
  z-index: 10;
}

.tab {
  flex: 1;
  text-align: center;
  color: #888;
  font-size: 12px;
  cursor: pointer;
}

.tab.active {
  color: #cbb6ff;
}
</style>
</head>

<body>

<h1>Dark Idle</h1>

<div class="void-card">

  <div class="void-orb">
    <img src="void.png" id="voidImage">
    <canvas id="voidCanvas"></canvas>
  </div>

  <div class="void-amount" id="counter">VOID: 0</div>
  <div class="void-sub">–¢—ë–º–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –∏—Å–∫–∞–∂–∞–µ—Ç –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</div>

  <button class="void-btn" onclick="collect()">–ò–∑–≤–ª–µ—á—å VOID</button>
  <div class="void-info" id="info"></div>
  <button class="void-btn" onclick="upgrade()">–£–ª—É—á—à–∏—Ç—å –¥–æ–±—ã—á—É (+1 VOID/—Å–µ–∫)</button>

</div>

<div id="tabbar">
  <div class="tab active">‚óâ –ò–≥—Ä–∞</div>
  <div class="tab">üèÜ –†–µ–π—Ç–∏–Ω–≥</div>
</div>

<script>
/* ===== SUPABASE ===== */
const SUPABASE_URL = "https://edosyzmykmoajecmaamu.supabase.co";
const SUPABASE_KEY = "sb_publishable_bHorYMm55LbnpSXg96WwVw_C4weLD_O";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* ===== TELEGRAM ===== */
const tg = Telegram.WebApp;
tg.ready();

/* ===== GAME DATA ===== */
let data = {
  voids: 0,
  rate: 1,
  is_vip: false,
  lastTime: Date.now()
};

/* ===== GAME LOGIC ===== */
function updateIdle() {
  const now = Date.now();
  const seconds = Math.floor((now - data.lastTime) / 1000);
  if (seconds > 0) {
    data.voids += seconds * data.rate * (data.is_vip ? 2 : 1);
    data.lastTime = now;
  }
}

function render() {
  const cost = 20 * data.rate * data.rate;
  counter.innerText = `VOID: ${Math.floor(data.voids)}`;
  info.innerText =
    `–°–∫–æ—Ä–æ—Å—Ç—å: ${data.rate} VOID/—Å–µ–∫ ${data.is_vip ? "üëë VIP" : ""}\n` +
    `–¶–µ–Ω–∞ —É–ª—É—á—à–µ–Ω–∏—è: ${cost} VOID`;
}

function collect() {
  Telegram.WebApp.HapticFeedback.impactOccurred("light");
  pulse = 1;
  updateIdle();
  render();
}

function upgrade() {
  const cost = 20 * data.rate * data.rate;
  if (data.voids < cost) {
    Telegram.WebApp.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ VOID");
    return;
  }
  data.voids -= cost;
  data.rate++;
  render();
}

/* ===== CANVAS VOID ===== */
const canvas = document.getElementById("voidCanvas");
const ctx = canvas.getContext("2d");

const SIZE = 260;
const DPR = window.devicePixelRatio || 1;

canvas.width = SIZE * DPR;
canvas.height = SIZE * DPR;
canvas.style.width = SIZE + "px";
canvas.style.height = SIZE + "px";
ctx.scale(DPR, DPR);

let time = 0;
let pulse = 0;

function drawVoid() {
  const cx = SIZE / 2;
  const cy = SIZE / 2;
  const baseRadius = 86;

  ctx.clearRect(0, 0, SIZE, SIZE);

  const points = 220;

  for (let i = 0; i < points; i++) {
    const angle = (i / points) * Math.PI * 2 + time * 0.002;
    const distortion =
      Math.sin(angle * 4 + time * 0.03) * 8 +
      Math.sin(angle * 9 - time * 0.02) * 5;

    const r = baseRadius + 22 + distortion - pulse * 10;

    const x = cx + Math.cos(angle) * r;
    const y = cy + Math.sin(angle) * r;

    ctx.fillStyle = "rgba(180,150,255,0.28)";
    ctx.beginPath();
    ctx.arc(x, y, 2.2, 0, Math.PI * 2);
    ctx.fill();
  }

  if (pulse > 0.01) {
    ctx.strokeStyle = `rgba(220,190,255,${pulse})`;
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(cx, cy, baseRadius + 30 - pulse * 20, 0, Math.PI * 2);
    ctx.stroke();
    pulse *= 0.88;
  }

  time++;
  requestAnimationFrame(drawVoid);
}

drawVoid();
render();
</script>

</body>
</html>
